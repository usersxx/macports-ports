# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                openjdk7-bootstrap
version             7
categories          java devel
platforms           {darwin any}
supported_archs     ppc i386 x86_64
license             GPL-2+
maintainers         {outlook.com:usersword123 @usersxx} openmaintainer
description         OpenJDK 7 Boot JDK
long_description    OpenJDK 7 Boot JDK to bootstrap Openjdk port
homepage            
use_xcode           no
use_configure       no
build {}
destroot.violate_mtree  yes
set path /Library/Java/JavaVirtualMachines/${name}
if {${configure.build_arch} eq "ppc"} {
    set build           2012-03-14
    set ver             1.7.0_2
    if 
    master_sites        https://macintoshgarden.org/sites/macintoshgarden.org/files/apps \
                        http://mirror.macintosharchive.org/macintoshgarden.org/files/apps \
                        http://old.macintosh.garden/apps \
                        ftp://repo1.macintoshgarden.org/Garden/apps

    checksums           rmd160  872bea18c8c153d0509d2d18ebe6da6a71161e3f \
                        sha256  0d3ffaa7c5a2873ec26fc97ce1f592bafa18e3ae52605f0a2ba039a75d4860a8 \
                        size    54392585

    distname            openjdk7u2-macppc-fcs-${build}
    distfiles           ${distname}.tar_.bz2
    use_bzip2           yes
    worksrcdir          ${distname}
    # Incompatible library version: /Library/Java/JavaVirtualMachines/openjdk7-bootstrap/jre/lib/ppc/libfontmanager.dylib requires version 13.0.0 or later
    depends_lib         port:freetype
    destroot {
        xinstall -m 755 -d ${destroot}${path}
        copy ${worksrcpath}/ASSEMBLY_EXCEPTION ${destroot}${path}
        copy ${worksrcpath}/bin ${destroot}${path}
        copy ${worksrcpath}/demo ${destroot}${path}
        copy ${worksrcpath}/include ${destroot}${path}
        copy ${worksrcpath}/jre ${destroot}${path}
        copy ${worksrcpath}/lib ${destroot}${path}
        copy ${worksrcpath}/LICENSE ${destroot}${path}
        copy ${worksrcpath}/man ${destroot}${path}
        copy ${worksrcpath}/release ${destroot}${path}
        copy ${worksrcpath}/sample ${destroot}${path}
        copy ${worksrcpath}/src.zip ${destroot}${path}
        copy ${worksrcpath}/THIRD_PARTY_README ${destroot}${path}
    }

    post-destroot {
        system "install_name_tool -change /usr/X11/lib/libfreetype.6.dylib ${prefix}/lib/libfreetype.6.dylib ${destroot}${path}/jre/lib/ppc/libfontmanager.dylib"
    }
} else {
    set web_date 20110823183837
    set build 20110709
    set ver 1.7
    master_sites        https://web.archive.org/web/${web_date}/http://openjdk-osx-build.googlecode.com/files/
    distfiles           OpenJDK-OSX-${ver}-universal-${build}.dmg

    checksums           rmd160  29117515254e526444aa463145d6be716e262c7e \
                        sha256  094515a4e7eea2731b0bb528ac4846da998b17f2ce2c4d5d6da925efe97bc870 \
                        size    75596620

    depends_extract     port:xar
    extract {
        system -W ${workpath} "mkdir -p ${worksrcpath}/packages"
        file copy ${distpath}/${distfiles} ${worksrcpath}/packages
        system -W ${workpath} "mkdir -p ${worksrcpath}/dmg"
        system -W ${workpath} "mkdir -p ${worksrcpath}/pkg"
        system -W ${workpath} "mkdir -p ${worksrcpath}/files"
        system -W ${worksrcpath}/packages "hdiutil attach ${worksrcpath}/packages/${distfiles} -mountroot ${worksrcpath}/dmg"
        system -W ${worksrcpath}/dmg "cp ${worksrcpath}/dmg/*/*.pkg ${worksrcpath}/pkg"
        system -W ${worksrcpath}/dmg "hdiutil detach ${worksrcpath}/dmg/*"
        system -W ${worksrcpath}/pkg "mv ${worksrcpath}/pkg/*.pkg ${worksrcpath}/pkg/jdk${ver}.pkg"
        system -W ${worksrcpath}/pkg "${prefix}/bin/xar -xf ${worksrcpath}/pkg/jdk${ver}.pkg -C ${worksrcpath}/files"
        system -W ${worksrcpath} "cpio -i < ${worksrcpath}/files/j2sdkimage.pkg/Payload"
        worksrcdir          jdk${ver}
    }
    destroot {
        xinstall -m 755 -d ${destroot}${path}
        copy ${worksrcpath}/Contents ${destroot}${path}
    }
}
