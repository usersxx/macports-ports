# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

name                openjdk-bootstrap
version             1.0
revision            0
maintainers         nomaintainer
license             GPL-2

if {${subport} eq ${name}} {
    set meta true
    description          "Meta port encompassing binary OpenJDK releases"
    long_description     {*}${description}
    homepage
    master_sites

    distfiles
    patchfiles
    supported_archs      noarch
    use_configure        no
    build {}
    destroot {
        set docdir ${destroot}${prefix}/share/doc/${subport}
        xinstall -d ${docdir}
        system "echo $subport is a stub port > ${docdir}/README"
    }

    notes {
        The openjdk-distributions port is not installable, but recommends users to install\
        the latest Long Term Support (LTS) subport
    }
}

subport openjdk6-apple {
    version             6
    revision            0
    description         Apple openjdk6
    long_description    This is the apple jdk
    homepage            https://www.apple.com/
    platforms           darwin
    supported_archs     x86_64 i386
    use_xcode           no
    if {${os.major} = 9} {
        distfiles           JavaForMacOSX10.5Update10.dmg
        master_sites        https://updates.cdn-apple.com/2019/cert/041-87778-20191017-622d65b9-1db2-4d13-bc46-4ab0d7c3240f
        checksums           rmd160  a9856f152646d2fb7e536f7caff15cb6a3a5900f \
                            sha256  bf64051f6d881560cbec5753918af52cc8bce2d3ef442de5365a8d767c2ced09 \
                            size    126236660
        worksrcdir          openjdk6-apple
        set path ${prefix}/Library
        set install /System/Library/Java
    } elseif {${os.major} = 10} {
        distfiles           JavaForMacOSX10.6.dmg
        master_sites        https://updates.cdn-apple.com/2019/cert/041-90813-20191011-3137b1ba-3379-40e8-8d46-ce9032952939
        checksums           rmd160  4018fdef04eb3e50a57c9eed29ed7601fe839102 \
                            sha256  a5e7e101673b87915c87dee8b527258aa2c06dcbc22b7c723d95008e3f025953 \
                            size    72873510
        worksrcdir          openjdk6-apple
        set path ${prefix}/Library
        set install /System/Library/Java
    } else {
        distfiles           JavaForOSX.dmg
        master_sites        https://updates.cdn-apple.com/2019/cert/041-88384-20191011-3d8da658-dca4-4a5b-b67c-26e686876403
        checksums           rmd160  c11a8a85a40fe31491f8663dd62551fde6838aad \
                            sha256  3a91bd24a0524df4cde9433f2ac56182818f78aacda36c7529b3d548e0c12e63 \
                            size    51101946
        worksrcdir          openjdk6-apple
        set install /Library/Java
    }
    extract {
        system -W ${workpath} "mkdir -p ${worksrcpath}/packages"
        file copy ${distpath}/${distfiles} ${worksrcpath}/packages
        system -W ${workpath} "mkdir -p ${worksrcpath}/dmg"
        system -W ${workpath} "mkdir -p ${worksrcpath}/pkg"
        system -W ${workpath} "mkdir -p ${worksrcpath}/files"
        system -W ${worksrcpath}/packages "hdiutil attach ${worksrcpath}/packages/${distfiles} -mountroot ${worksrcpath}/dmg"
        system -W ${worksrcpath}/dmg "cp ${worksrcpath}/dmg/*/*.pkg ${worksrcpath}/pkg"
        system -W ${worksrcpath}/dmg "hdiutil detach ${worksrcpath}/dmg/*"
        system -W ${worksrcpath}/pkg "mv ${worksrcpath}/pkg/*.pkg ${worksrcpath}/pkg/jdk${version}.pkg"
        system -W ${worksrcpath}/pkg "${prefix}/bin/xar -xf ${worksrcpath}/pkg/jdk${version}.pkg -C ${worksrcpath}/files"
        system -W ${worksrcpath} "cpio -i < ${worksrcpath}/files/${distfiles}/Payload"
    }
    universal_variant   yes
    use_configure    no
    build {}
    destroot {
       xinstall -m 755 -d ${destroot}${path}
       copy ${worksrcpath}${install} ${destroot}${path}
    }
}
